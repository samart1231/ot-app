<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</title>
  <script src="{{ url_for('static', filename='js/tailwind.min.js') }}"></script>
</head>
<body class="bg-gray-100 text-gray-800 p-6">

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
  <div class="mb-4">
    <a href="{{ url_for('index') }}"
       class="inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold px-4 py-2 rounded shadow">
     ‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    </a>
  </div>

  <!-- ‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
  <h1 class="text-2xl font-bold mb-4">üìí ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö - ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<form method="POST" class="bg-white p-4 rounded shadow mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
  <div>
    <label class="block font-semibold mb-1">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="date" name="date" required class="w-full border rounded p-2">
  </div>

  <div>
    <label class="block font-semibold mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
    <select id="category" name="category" onchange="updateItems()" required class="w-full border rounded p-2">
      <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó--</option>
      <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
      <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
      <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
    </select>
  </div>

  <div class="md:col-span-2">
    <label class="block font-semibold mb-1">üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
    <div class="border rounded p-3 bg-white">
      <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß -->
      <div id="selected-items" class="mb-4 space-y-2"></div>

      <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
      <div class="grid grid-cols-1 md:grid-cols-5 gap-2 items-end">
        <div>
          <label class="block text-sm font-medium mb-1">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <div class="relative">
            <select id="item-select" class="w-full border rounded p-2">
              <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤--</option>
            </select>
            <button type="button" onclick="toggleCustomItem()"
                    class="absolute right-8 top-1/2 transform -translate-y-1/2 text-blue-600 hover:text-blue-800 text-sm"
                    title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà">
              ‚ûï
            </button>
          </div>
          <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
          <input type="text" id="custom-item" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà..."
                 class="w-full border rounded p-2 mt-1 hidden">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
          <input type="number" id="item-price" step="0.01" placeholder="0.00" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
          <input type="number" id="item-quantity" min="1" value="1" class="w-full border rounded p-2">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <input type="text" id="item-note" placeholder="‡∏Ç‡∏ô‡∏≤‡∏î/‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥" class="w-full border rounded p-2">
        </div>
        <div>
          <button type="button" onclick="addItem()" class="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°
          </button>
        </div>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡πá‡∏ß -->
      <div class="mt-3 pt-3 border-t">
        <div class="flex flex-wrap gap-2">
          <button type="button" onclick="quickAddItem('‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å', 25)" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200">
            ‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å 25‡∏ø
          </button>
          <button type="button" onclick="quickAddItem('‡πÅ‡∏Å‡∏á‡∏ñ‡∏∏‡∏á', 25)" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200">
            ‡πÅ‡∏Å‡∏á‡∏ñ‡∏∏‡∏á 25‡∏ø
          </button>
          <button type="button" onclick="quickAddItem('‡∏Å‡∏≤‡πÅ‡∏ü', 17)" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200">
            ‡∏Å‡∏≤‡πÅ‡∏ü 17‡∏ø
          </button>
          <button type="button" onclick="quickAddItem('‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß', 10)" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200">
            ‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß 10‡∏ø
          </button>
          <button type="button" onclick="quickAddItem('‡∏Å‡∏≤‡πÅ‡∏ü‡∏ã‡∏≠‡∏á', 5)" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-sm hover:bg-blue-200">
            ‡∏Å‡∏≤‡πÅ‡∏ü‡∏ã‡∏≠‡∏á 5‡∏ø
          </button>
          <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
          <div id="recent-items" class="flex flex-wrap gap-2"></div>
        </div>
      </div>

      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
      <div class="mt-3 pt-3 border-t">
        <button type="button" onclick="showManageItems()"
                class="text-blue-600 hover:text-blue-800 text-sm underline">
          üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        </button>
      </div>
    </div>

    <!-- ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <div class="mt-2 flex justify-between items-center">
      <button type="button" onclick="clearAllItems()"
              class="text-red-600 hover:text-red-800 text-sm underline">
        ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
      </button>
      <div class="text-right">
        <span class="font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <span id="total-items" class="text-green-600">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
        <br>
        <span class="font-semibold text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total-amount" class="text-blue-600">0.00</span> ‡∏ö‡∏≤‡∏ó</span>
      </div>
    </div>

    <!-- Hidden inputs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <input type="hidden" id="items-data" name="items_data" required>
    <input type="hidden" id="calculated-total" name="amount" required>
    <input type="hidden" id="description" name="description">
  </div>

  <div>
    <label class="block font-semibold mb-1">üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</label>
    <select name="vendor" class="w-full border rounded p-2">
      <option value="">-- ‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
      <option value="‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏¢‡∏à‡πà‡∏≠‡∏¢">‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏¢‡∏à‡πà‡∏≠‡∏¢</option>
      <option value="‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡∏±‡∏Å">‡∏£‡πâ‡∏≤‡∏ô‡∏ú‡∏±‡∏Å</option>
      <option value="‡πÄ‡∏à‡πâ‡∏ô‡∏±‡∏ô">‡πÄ‡∏à‡πâ‡∏ô‡∏±‡∏ô</option>
      <option value="‡∏û‡∏µ‡πà‡πÅ‡∏Å‡πà">‡∏û‡∏µ‡πà‡πÅ‡∏Å‡πà</option>
      <option value="‡∏û‡∏µ‡πà‡∏≠‡∏≤‡∏£‡πå‡∏°">‡∏û‡∏µ‡πà‡∏≠‡∏≤‡∏£‡πå‡∏°</option>
      <option value="7-seven">7-seven</option>
    </select>
  </div>

  <div class="md:col-span-2 text-right">
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow">
      ‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    </button>
  </div>
</form>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <div class="bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <table class="w-full table-auto text-sm">
      <thead class="bg-gray-200 text-left">
        <tr>
          <th class="px-4 py-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th class="px-4 py-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
          <th class="px-4 py-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="px-4 py-2">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th class="px-4 py-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th class="px-4 py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        {% for r in records %}
        <tr class="border-t hover:bg-gray-50">
          <td class="px-4 py-2">{{ r['date'] }}</td>
          <td class="px-4 py-2">{{ r['description'] }}</td>
          <td class="px-4 py-2">{{ '{:,.2f}'.format(r['amount']) }}</td>
          <td class="px-4 py-2">{{ r['vendor'] }}</td>
          <td class="px-4 py-2">
            {% if r['category'] == 'income' %}
              <span class="text-green-600 font-semibold">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
            {% else %}
              <span class="text-red-600 font-semibold">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
            {% endif %}
          </td>
          <td class="px-4 py-2 flex gap-2">
            <form method="get" action="{{ url_for('edit_income_expense', id=r['id']) }}">
              <button class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            </form>
           <form method="post" action="{{ url_for('delete_income_expense', id=r['id']) }}" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?');">
<form method="post" action="{{ url_for('delete_income_expense', id=r['id']) }}" onsubmit="return confirmDelete('{{ r['description'] }}');">
  <button class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700">‡∏•‡∏ö</button>
</form>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ‡∏£‡∏ß‡∏° -->
  <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-green-100 p-4 rounded shadow text-green-800 font-bold">
      ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö: {{ '{:,.2f}'.format(total_income) }} ‡∏ö‡∏≤‡∏ó
    </div>
    <div class="bg-red-100 p-4 rounded shadow text-red-800 font-bold">
      ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢: {{ '{:,.2f}'.format(total_expense) }} ‡∏ö‡∏≤‡∏ó
    </div>
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
  <h2 class="text-xl font-bold mt-10 mb-4">üìÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
  <table class="w-full table-auto text-sm bg-white shadow rounded">
    <thead class="bg-gray-200">
      <tr>
        <th class="px-4 py-2">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
        <th class="px-4 py-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th class="px-4 py-2">‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th>
        <th class="px-4 py-2">Export</th>
      </tr>
    </thead>
    <tbody>
      {% for row in monthly_summary %}
      <tr class="border-t hover:bg-gray-50">
        <td class="px-4 py-2">
          <form method="get" action="{{ url_for('income_expense_month_view', year_month=row['month']) }}">
            <button class="text-white bg-indigo-600 px-3 py-1 rounded hover:bg-indigo-700">
              {{ row['month'] }}
            </button>
          </form>
        </td>
        <td class="px-4 py-2">
          {% if row['category'] == 'income' %}
            <span class="text-green-600 font-semibold">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
          {% else %}
            <span class="text-red-600 font-semibold">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</span>
          {% endif %}
        </td>
        <td class="px-4 py-2">{{ '{:,.2f}'.format(row['total']) }}</td>
        <td class="px-4 py-2">
          <a href="{{ url_for('export_income_expense_month', category=row['category'], year_month=row['month']) }}"
             class="text-sm px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700">
            üì§ Export
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

<!-- Modal ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
<div id="manage-items-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-[80vh] overflow-hidden">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="text-lg font-semibold">üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div class="flex gap-2">
          <button type="button" onclick="exportItems()"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
            üì§ Export
          </button>
          <button type="button" onclick="importItems()"
                  class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
            üì• Import
          </button>
        </div>
      </div>

      <!-- ‡πÅ‡∏ó‡πá‡∏ö -->
      <div class="border-b">
        <div class="flex">
          <button onclick="switchTab('default')" id="tab-default"
                  class="px-4 py-2 border-b-2 border-blue-500 bg-blue-50 text-blue-600 font-medium">
            ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
          </button>
          <button onclick="switchTab('custom')" id="tab-custom"
                  class="px-4 py-2 border-b-2 border-transparent hover:bg-gray-50">
            ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
          </button>
          <button onclick="switchTab('add')" id="tab-add"
                  class="px-4 py-2 border-b-2 border-transparent hover:bg-gray-50">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
          </button>
        </div>
      </div>

      <div class="p-4 overflow-y-auto max-h-96">
        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
        <div id="content-default" class="tab-content">
          <div id="default-items-content"></div>
        </div>

        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á -->
        <div id="content-custom" class="tab-content hidden">
          <div id="custom-items-content"></div>
        </div>

        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
        <div id="content-add" class="tab-content hidden">
          <div class="max-w-md mx-auto">
            <div class="space-y-4">
              <div>
                <label class="block font-medium mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <select id="new-item-category" class="w-full border rounded p-2">
                  <option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó--</option>
                  <option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£">‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                  <option value="‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ">‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ</option>
                  <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                </select>
              </div>
              <div>
                <label class="block font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                <input type="text" id="new-item-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" class="w-full border rounded p-2">
              </div>
              <div>
                <label class="block font-medium mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                <input type="number" id="new-item-price" step="0.01" placeholder="0.00" class="w-full border rounded p-2">
              </div>
              <div class="flex gap-2">
                <button type="button" onclick="addNewItemFromModal()"
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                  ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
                <button type="button" onclick="clearNewItemForm()"
                        class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                  ‡∏•‡πâ‡∏≤‡∏á
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="p-4 border-t flex justify-between">
        <div class="flex gap-2">
          <button type="button" onclick="resetAllItems()"
                  class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
            üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
        </div>
        <button type="button" onclick="hideManageItems()"
                class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
          ‡∏õ‡∏¥‡∏î
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Hidden file input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö import -->
<input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImportFile(event)">

<script>
// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
let customItems = JSON.parse(localStorage.getItem('customItems')) || {};
let recentItems = JSON.parse(localStorage.getItem('recentItems')) || [];

// ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ)
let items = JSON.parse(localStorage.getItem('defaultItems')) || {
    "‡∏≠‡∏≤‡∏´‡∏≤‡∏£": [
        {name: "‡∏õ‡∏•‡∏≤‡∏ó‡∏π", defaultPrice: 25},
        {name: "‡πÅ‡∏Å‡∏á‡∏ñ‡∏∏‡∏á", defaultPrice: 25},
        {name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà", defaultPrice: 20},
        {name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß", defaultPrice: 10},
        {name: "‡∏Ç‡∏ô‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á", defaultPrice: 10},
        {name: "‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å", defaultPrice: 55}
    ],
    "‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ": [
        {name: "‡∏™‡∏ö‡∏π‡πà", defaultPrice: 25},
        {name: "‡∏¢‡∏≤‡∏™‡∏µ‡∏ü‡∏±‡∏ô", defaultPrice: 45},
        {name: "‡πÅ‡∏ä‡∏°‡∏û‡∏π", defaultPrice: 120},
        {name: "‡∏ú‡∏á‡∏ã‡∏±‡∏Å‡∏ü‡∏≠‡∏Å", defaultPrice: 85},
        {name: "‡∏ñ‡∏∏‡∏á‡∏Ç‡∏¢‡∏∞", defaultPrice: 30},
        {name: "‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà", defaultPrice: 35}
    ],
    "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°": [
        {name: "‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤", defaultPrice: 8},
        {name: "‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°", defaultPrice: 15},
        {name: "‡∏Å‡∏≤‡πÅ‡∏ü", defaultPrice: 17},
        {name: "‡∏Å‡∏≤‡πÅ‡∏ü‡∏ã‡∏≠‡∏á", defaultPrice: 5},
        {name: "‡∏ä‡∏≤", defaultPrice: 20},
        {name: "‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ", defaultPrice: 30},
        {name: "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á", defaultPrice: 10}
    ]
};

let selectedItems = [];
let itemCounter = 0;
let currentTab = 'default';

function updateItems() {
    const category = document.getElementById("category").value;
    const itemSelect = document.getElementById("item-select");
    const priceInput = document.getElementById("item-price");

    itemSelect.innerHTML = '<option value="">--‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤--</option>';
    priceInput.value = '';

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    if (items[category]) {
        items[category].forEach(function(item) {
            const option = document.createElement("option");
            option.value = JSON.stringify({...item, type: 'default'});
            option.text = `${item.name} (${item.defaultPrice} ‡∏ö‡∏≤‡∏ó)`;
            itemSelect.appendChild(option);
        });
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
    if (customItems[category]) {
        customItems[category].forEach(function(item) {
            const option = document.createElement("option");
            option.value = JSON.stringify({...item, type: 'custom'});
            option.text = `${item.name} (${item.defaultPrice} ‡∏ö‡∏≤‡∏ó) üî∏`;
            itemSelect.appendChild(option);
        });
    }

    updateRecentItems();
}

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö
function switchTab(tabName) {
    try {
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        document.querySelectorAll('[id^="tab-"]').forEach(tab => {
            tab.className = 'px-4 py-2 border-b-2 border-transparent hover:bg-gray-50';
        });
        document.getElementById(`tab-${tabName}`).className = 'px-4 py-2 border-b-2 border-blue-500 bg-blue-50 text-blue-600 font-medium';

        // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô content
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        document.getElementById(`content-${tabName}`).classList.remove('hidden');

        currentTab = tabName;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÅ‡∏ó‡πá‡∏ö
        if (tabName === 'default') {
            loadDefaultItems();
        } else if (tabName === 'custom') {
            loadCustomItems();
        }
    } catch (error) {
        console.error('Error switching tab:', error);
    }
}

// ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
function toggleCustomItem() {
    const customItemInput = document.getElementById("custom-item");
    const itemSelect = document.getElementById("item-select");

    if (customItemInput.classList.contains('hidden')) {
        customItemInput.classList.remove('hidden');
        customItemInput.focus();
        itemSelect.value = '';
    } else {
        customItemInput.classList.add('hidden');
        customItemInput.value = '';
    }
}

// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
document.addEventListener('DOMContentLoaded', function() {
    const customItemInput = document.getElementById("custom-item");
    if (customItemInput) {
        customItemInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById("item-price").focus();
            }
        });
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const itemSelect = document.getElementById("item-select");
    if (itemSelect) {
        itemSelect.onchange = function() {
            const priceInput = document.getElementById("item-price");
            const customItemInput = document.getElementById("custom-item");

            if (this.value) {
                try {
                    const item = JSON.parse(this.value);
                    priceInput.value = item.defaultPrice;
                    customItemInput.value = '';
                    customItemInput.classList.add('hidden');
                } catch (error) {
                    console.error('Error parsing item:', error);
                }
            } else {
                priceInput.value = '';
            }
        };
    }

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    updateSelectedItemsDisplay();
    updateRecentItems();
});

function addItem() {
    try {
        const itemSelect = document.getElementById("item-select");
        const customItemInput = document.getElementById("custom-item");
        const priceInput = document.getElementById("item-price");
        const quantityInput = document.getElementById("item-quantity");
        const noteInput = document.getElementById("item-note");
        const categorySelect = document.getElementById("category");

        let itemName = '';
        let isCustomItem = false;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å dropdown ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á
        if (itemSelect.value) {
            const item = JSON.parse(itemSelect.value);
            itemName = item.name;
        } else if (customItemInput.value.trim()) {
            itemName = customItemInput.value.trim();
            isCustomItem = true;
        }

        if (!itemName || !priceInput.value || !quantityInput.value) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
            return;
        }

        const price = parseFloat(priceInput.value);
        const quantity = parseInt(quantityInput.value);
        const note = noteInput.value.trim();
        const total = price * quantity;
        const category = categorySelect.value;

        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
        if (isCustomItem && category) {
            saveCustomItem(category, itemName, price);
            addToRecentItems(itemName, price);
        }

        const newItem = {
            id: ++itemCounter,
            name: itemName,
            price: price,
            quantity: quantity,
            note: note,
            total: total
        };

        selectedItems.push(newItem);
        updateSelectedItemsDisplay();

        // Reset form
        itemSelect.value = '';
        customItemInput.value = '';
        customItemInput.classList.add('hidden');
        priceInput.value = '';
        quantityInput.value = 1;
        noteInput.value = '';
    } catch (error) {
        console.error('Error adding item:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
    }
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
function saveCustomItem(category, name, price) {
    if (!customItems[category]) {
        customItems[category] = [];
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const existingItem = customItems[category].find(item => item.name.toLowerCase() === name.toLowerCase());
    if (!existingItem) {
        customItems[category].push({
            name: name,
            defaultPrice: price
        });
        localStorage.setItem('customItems', JSON.stringify(customItems));
        updateItems(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï dropdown
    }
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
function addToRecentItems(name, price) {
    const newItem = {name: name, price: price};

    // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    recentItems = recentItems.filter(item => item.name !== name);

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    recentItems.unshift(newItem);

    // ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà 5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    recentItems = recentItems.slice(0, 5);

    localStorage.setItem('recentItems', JSON.stringify(recentItems));
    updateRecentItems();
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
function updateRecentItems() {
    const container = document.getElementById("recent-items");
    if (container) {
        container.innerHTML = '';

        recentItems.forEach(item => {
            const button = document.createElement("button");
            button.type = "button";
            button.className = "bg-purple-100 text-purple-800 px-3 py-1 rounded text-sm hover:bg-purple-200";
            button.textContent = `${item.name} ${item.price}‡∏ø üî∏`;
            button.onclick = () => quickAddItem(item.name, item.price);
            container.appendChild(button);
        });
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß
function quickAddItem(itemName, price) {
    const newItem = {
        id: ++itemCounter,
        name: itemName,
        price: price,
        quantity: 1,
        note: '',
        total: price
    };

    selectedItems.push(newItem);
    updateSelectedItemsDisplay();
}

function removeItem(itemId) {
    selectedItems = selectedItems.filter(item => item.id !== itemId);
    updateSelectedItemsDisplay();
}

function updateQuantity(itemId, newQuantity) {
    const item = selectedItems.find(item => item.id === itemId);
    if (item && newQuantity > 0) {
        item.quantity = parseInt(newQuantity);
        item.total = item.price * item.quantity;
        updateSelectedItemsDisplay();
    }
}

function updatePrice(itemId, newPrice) {
    const item = selectedItems.find(item => item.id === itemId);
    if (item && newPrice >= 0) {
        item.price = parseFloat(newPrice);
        item.total = item.price * item.quantity;
        updateSelectedItemsDisplay();
    }
}

function updateNote(itemId, newNote) {
    const item = selectedItems.find(item => item.id === itemId);
    if (item) {
        item.note = newNote;
        updateSelectedItemsDisplay();
    }
}

function duplicateItem(itemId) {
    const item = selectedItems.find(item => item.id === itemId);
    if (item) {
        const newItem = {
            id: ++itemCounter,
            name: item.name,
            price: item.price,
            quantity: item.quantity,
            note: item.note,
            total: item.total
        };
        selectedItems.push(newItem);
        updateSelectedItemsDisplay();
    }
}

function updateSelectedItemsDisplay() {
    const container = document.getElementById("selected-items");
    const itemsDataInput = document.getElementById("items-data");
    const calculatedTotalInput = document.getElementById("calculated-total");
    const descriptionInput = document.getElementById("description");
    const totalAmountSpan = document.getElementById("total-amount");
    const totalItemsSpan = document.getElementById("total-items");

    if (!container) return;

    container.innerHTML = '';
    let grandTotal = 0;
    let descriptionItems = [];

    if (selectedItems.length === 0) {
        container.innerHTML = '<div class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>';
    } else {
        selectedItems.forEach((item, index) => {
            grandTotal += item.total;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á description ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            let itemDesc = `${item.name} x${item.quantity}`;
            if (item.note) {
                itemDesc += ` (${item.note})`;
            }
            descriptionItems.push(itemDesc);

            const itemDiv = document.createElement("div");
            itemDiv.className = "flex items-center justify-between bg-gray-50 p-3 rounded border";
            itemDiv.innerHTML = `
                <div class="flex-1">
                    <div class="flex items-center gap-2">
                        <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded">${index + 1}</span>
                        <span class="font-medium">${item.name}</span>
                        ${item.note ? `<span class="text-sm text-gray-500">(${item.note})</span>` : ''}
                    </div>
                    <div class="mt-1 flex items-center gap-4 text-sm">
                        <div>
                            ‡∏£‡∏≤‡∏Ñ‡∏≤: <input type="number" value="${item.price}" step="0.01" min="0"
                                   onchange="updatePrice(${item.id}, this.value)"
                                   class="w-16 border rounded px-1 text-center"> ‡∏ö‡∏≤‡∏ó
                        </div>
                        <div>
                            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: <input type="number" value="${item.quantity}" min="1"
                                   onchange="updateQuantity(${item.id}, this.value)"
                                   class="w-16 border rounded px-1 text-center">
                        </div>
                        <div class="font-medium text-blue-600">
                            = ${item.total.toFixed(2)} ‡∏ö‡∏≤‡∏ó
                        </div>
                    </div>
                    <div class="mt-1">
                        <input type="text" value="${item.note}" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..."
                               onchange="updateNote(${item.id}, this.value)"
                               class="w-full text-sm border rounded px-2 py-1">
                    </div>
                </div>
                <div class="ml-2 flex flex-col gap-1">
                    <button type="button" onclick="duplicateItem(${item.id})"
                            class="text-green-600 hover:text-green-800 text-sm" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å">
                        üìã
                    </button>
                    <button type="button" onclick="removeItem(${item.id})"
                            class="text-red-600 hover:text-red-800" title="‡∏•‡∏ö">
                        ‚úï
                    </button>
                </div>
            `;
            container.appendChild(itemDiv);
        });
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
    if (totalItemsSpan) totalItemsSpan.textContent = selectedItems.length;
    if (totalAmountSpan) totalAmountSpan.textContent = grandTotal.toFixed(2);

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend
    if (itemsDataInput) itemsDataInput.value = JSON.stringify(selectedItems);
    if (calculatedTotalInput) calculatedTotalInput.value = grandTotal.toFixed(2);
    if (descriptionInput) descriptionInput.value = descriptionItems.join(', ');

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (itemsDataInput) itemsDataInput.required = selectedItems.length === 0;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
function clearAllItems() {
    if (selectedItems.length > 0 && confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        selectedItems = [];
        updateSelectedItemsDisplay();
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Modal
function showManageItems() {
    const modal = document.getElementById("manage-items-modal");
    if (modal) {
        modal.classList.remove('hidden');
        switchTab('default');
    }
}

function hideManageItems() {
    const modal = document.getElementById("manage-items-modal");
    if (modal) {
        modal.classList.add('hidden');
    }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function loadDefaultItems() {
    const container = document.getElementById("default-items-content");
    if (!container) return;

    let html = '';

    Object.keys(items).forEach(category => {
        html += `<div class="mb-6">
            <div class="flex justify-between items-center mb-3">
                <h4 class="font-semibold text-lg">${category}</h4>
                <button onclick="addDefaultItem('${category}')"
                        class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">`;

        items[category].forEach((item, index) => {
            html += `<div class="flex items-center justify-between bg-gray-50 p-3 rounded border">
                <div class="flex-1">
                    <input type="text" value="${item.name}"
                           onchange="updateDefaultItemName('${category}', ${index}, this.value)"
                           class="font-medium bg-transparent border-none outline-none w-full">
                    <div class="flex items-center gap-2 mt-1">
                        <span class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
                        <input type="number" value="${item.defaultPrice}" step="0.01" min="0"
                               onchange="updateDefaultItemPrice('${category}', ${index}, this.value)"
                               class="w-20 border rounded px-2 py-1 text-sm">
                        <span class="text-sm text-gray-600">‡∏ö‡∏≤‡∏ó</span>
                    </div>
                </div>
                <button onclick="deleteDefaultItem('${category}', ${index})"
                        class="text-red-600 hover:text-red-800 ml-2" title="‡∏•‡∏ö">
                    ‚úï
                </button>
            </div>`;
        });

        html += `</div></div>`;
    });

    container.innerHTML = html;
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
function loadCustomItems() {
    const container = document.getElementById("custom-items-content");
    if (!container) return;

    let html = '';

    Object.keys(customItems).forEach(category => {
        if (customItems[category].length > 0) {
            html += `<div class="mb-6">
                <h4 class="font-semibold text-lg mb-3">${category}</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">`;

            customItems[category].forEach((item, index) => {
                html += `<div class="flex items-center justify-between bg-gray-50 p-3 rounded border">
                    <div class="flex-1">
                        <input type="text" value="${item.name}"
                               onchange="updateCustomItemName('${category}', ${index}, this.value)"
                               class="font-medium bg-transparent border-none outline-none w-full">
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-sm text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
                            <input type="number" value="${item.defaultPrice}" step="0.01" min="0"
                                   onchange="updateCustomItemPrice('${category}', ${index}, this.value)"
                                   class="w-20 border rounded px-2 py-1 text-sm">
                            <span class="text-sm text-gray-600">‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                    <button onclick="deleteCustomItem('${category}', ${index})"
                            class="text-red-600 hover:text-red-800 ml-2" title="‡∏•‡∏ö">
                        ‚úï
                    </button>
                </div>`;
            });

            html += `</div></div>`;
        }
    });

    if (html === '') {
        html = '<div class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á</div>';
    }

    container.innerHTML = html;
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function addDefaultItem(category) {
    const name = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:');
    if (!name || name.trim() === '') return;

    const priceStr = prompt('‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:');
    const price = parseFloat(priceStr);
    if (isNaN(price) || price < 0) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
    }

    if (!items[category]) {
        items[category] = [];
    }

    items[category].push({
        name: name.trim(),
        defaultPrice: price
    });

    saveDefaultItems();
    loadDefaultItems();
    updateItems();
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function updateDefaultItemName(category, index, newName) {
    if (newName.trim()) {
        items[category][index].name = newName.trim();
        saveDefaultItems();
        updateItems();
    }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function updateDefaultItemPrice(category, index, newPrice) {
    const price = parseFloat(newPrice);
    if (price >= 0) {
        items[category][index].defaultPrice = price;
        saveDefaultItems();
        updateItems();
    }
}

// ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
function deleteDefaultItem(category, index) {
    if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        items[category].splice(index, 1);
        saveDefaultItems();
        loadDefaultItems();
        updateItems();
    }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
function updateCustomItemName(category, index, newName) {
    if (newName.trim()) {
        customItems[category][index].name = newName.trim();
        saveCustomItems();
        updateItems();
    }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
function updateCustomItemPrice(category, index, newPrice) {
    const price = parseFloat(newPrice);
    if (price >= 0) {
        customItems[category][index].defaultPrice = price;
        saveCustomItems();
        updateItems();
    }
}

// ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
function deleteCustomItem(category, index) {
    if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        customItems[category].splice(index, 1);
        if (customItems[category].length === 0) {
            delete customItems[category];
        }
        saveCustomItems();
        updateItems();
        loadCustomItems();
    }
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å Modal
function addNewItemFromModal() {
    const category = document.getElementById('new-item-category').value;
    const name = document.getElementById('new-item-name').value.trim();
    const price = parseFloat(document.getElementById('new-item-price').value);

    if (!category || !name || isNaN(price) || price < 0) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    const existsInDefault = items[category] && items[category].some(item =>
        item.name.toLowerCase() === name.toLowerCase()
    );
    const existsInCustom = customItems[category] && customItems[category].some(item =>
        item.name.toLowerCase() === name.toLowerCase()
    );

    if (existsInDefault || existsInCustom) {
        alert('‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
        return;
    }

    saveCustomItem(category, name, price);
    clearNewItemForm();

    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
    if (currentTab === 'custom') {
        loadCustomItems();
    }
    updateItems();

    alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
}

// ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function clearNewItemForm() {
    const categorySelect = document.getElementById('new-item-category');
    const nameInput = document.getElementById('new-item-name');
    const priceInput = document.getElementById('new-item-price');

    if (categorySelect) categorySelect.value = '';
    if (nameInput) nameInput.value = '';
    if (priceInput) priceInput.value = '';
}

// Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function exportItems() {
    const data = {
        defaultItems: items,
        customItems: customItems,
        recentItems: recentItems,
        exportDate: new Date().toISOString(),
        version: "1.0"
    };

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    alert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
}

// Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function importItems() {
    document.getElementById('import-file').click();
}

function handleImportFile(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);

            if (!data.defaultItems && !data.customItems) {
                alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }

            if (confirm('‡∏Å‡∏≤‡∏£ Import ‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                if (data.defaultItems) {
                    items = data.defaultItems;
                    saveDefaultItems();
                }

                if (data.customItems) {
                    customItems = data.customItems;
                    saveCustomItems();
                }

                if (data.recentItems) {
                    recentItems = data.recentItems;
                    localStorage.setItem('recentItems', JSON.stringify(recentItems));
                }

                // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
                updateItems();
                loadDefaultItems();
                loadCustomItems();
                updateRecentItems();

                alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
        } catch (error) {
            console.error('Import error:', error);
            alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        }
    };
    reader.readAsText(file);

    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ input
    event.target.value = '';
}

// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
function resetAllItems() {
    if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')) {
        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        items = {
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£": [
                {name: "‡∏õ‡∏•‡∏≤‡∏ó‡∏π", defaultPrice: 25},
                {name: "‡πÅ‡∏Å‡∏á‡∏ñ‡∏∏‡∏á", defaultPrice: 25},
                {name: "‡∏ô‡πà‡∏≠‡∏á‡πÑ‡∏Å‡πà", defaultPrice: 20},
                {name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß", defaultPrice: 10},
                {name: "‡∏Ç‡∏ô‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á", defaultPrice: 10},
                {name: "‡∏õ‡∏•‡∏≤‡∏î‡∏∏‡∏Å", defaultPrice: 55}
            ],
            "‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ": [
                {name: "‡∏™‡∏ö‡∏π‡πà", defaultPrice: 25},
                {name: "‡∏¢‡∏≤‡∏™‡∏µ‡∏ü‡∏±‡∏ô", defaultPrice: 45},
                {name: "‡πÅ‡∏ä‡∏°‡∏û‡∏π", defaultPrice: 120},
                {name: "‡∏ú‡∏á‡∏ã‡∏±‡∏Å‡∏ü‡∏≠‡∏Å", defaultPrice: 85},
                {name: "‡∏ñ‡∏∏‡∏á‡∏Ç‡∏¢‡∏∞", defaultPrice: 30},
                {name: "‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà", defaultPrice: 35}
            ],
            "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°": [
                {name: "‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤", defaultPrice: 8},
                {name: "‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°", defaultPrice: 15},
                {name: "‡∏Å‡∏≤‡πÅ‡∏ü", defaultPrice: 17},
                {name: "‡∏Å‡∏≤‡πÅ‡∏ü‡∏ã‡∏≠‡∏á", defaultPrice: 5},
                {name: "‡∏ä‡∏≤", defaultPrice: 20},
                {name: "‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ", defaultPrice: 30},
                {name: "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á", defaultPrice: 10}
            ]
        };

        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏á
        customItems = {};
        recentItems = [];

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        saveDefaultItems();
        saveCustomItems();
        localStorage.removeItem('recentItems');

        updateItems();
        loadDefaultItems();
        loadCustomItems();
        updateRecentItems();

        alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
    }
}

// ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
function saveDefaultItems() {
    localStorage.setItem('defaultItems', JSON.stringify(items));
}

function saveCustomItems() {
    localStorage.setItem('customItems', JSON.stringify(customItems));
}

function confirmDelete(description) {
  return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ' + description + ' ?');
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
function autoBackup() {
    const backupData = {
        defaultItems: items,
        customItems: customItems,
        recentItems: recentItems,
        backupDate: new Date().toISOString()
    };

    localStorage.setItem('itemsBackup', JSON.stringify(backupData));
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ backup ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
setInterval(autoBackup, 5 * 60 * 1000);

// Backup ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤
window.addEventListener('beforeunload', autoBackup);
</script>

</body>
</html>